@attribute [Route(RouteHelper.UserDetailsId)]

@if (_loaded) {
  if (Id == "new" || !string.IsNullOrWhiteSpace(_model.Email)) {
    @if (Id == "new") {
      <h1>New user</h1>
    } else {
      <h1>User details for: @_model.Email</h1>
    }
    
    <EditForm Model="@_model">
      @if (Id == "new") {
        <h3>Email: <TelerikTextBox @bind-Value="_model.Email" Width="300px" /></h3>
      }
      <h3>
        Role:
        <TelerikDropDownList Data="@_roles"
                             @bind-Value="@_model.Role"
                             TextField="Name"
                             ValueField="Value"
                             Width="300px" />
      </h3>
      @if (Role == ClaimsHelper.UserRoleAdmin && _model.Role != ClaimsHelper.UserRoleAdmin) {
        <h3>
          Company:
          <TelerikDropDownList Data="@_companies"
                               @bind-Value="@_model.CompanyId"
                               TextField="Name"
                               ValueField="Value"
                               Width="300px" />
        </h3>
      }
      @if (_model.Role == ClaimsHelper.UserRoleCardIssuerUser) {
        <h3>Permissions</h3>
        <ul style="list-style-type: none">
          @foreach (PermissionDto permission in _model.Permissions) {
            <li><TelerikCheckBox @bind-Value="@permission.HasPermission" Id="@permission.Value" /> <label for="@permission.Value">@permission.Value</label></li>
          }
        </ul>
      }
      <TelerikButton Rounded="@(ThemeConstants.Button.Rounded.Large)"
                     ButtonType="@ButtonType.Submit"
                     ThemeColor="@(ThemeConstants.Button.ThemeColor.Primary)"
                     OnClick="Save">
        <span class="@IconsHelper.Save me-1"></span> Save
      </TelerikButton>
    </EditForm>
  } else {
    <h1>User not found</h1>
    <p>Big flop, can't find that user</p>
  }
} else {
  <h1>Loading...</h1>
}